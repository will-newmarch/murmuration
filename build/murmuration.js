var Murmuration=function(){"use strict";function s(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),this.x=t,this.y=i,this.z=e}s.prototype.getDistanceFrom=function(t){var i={};return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,Math.abs(Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z))},s.prototype.normalise=function(t){var i=Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z);this.x=t*(this.x/i),this.y=t*(this.y/i),this.z=t*(this.z/i)},s.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},s.prototype.multiply=function(t){this.x*=t,this.y*=t,this.z*=t},s.prototype.reset=function(){this.x=0,this.y=0,this.z=0},s.prototype.toString=function(){return"<"+this.x+","+this.y+","+this.z+">"};function t(t){var i=this;this.starlingCount=200,this.homing=1,this.alignment=1,this.cohesion=1,this.separation=1,this.randomiseHome=!0,this.homeChangeInterval=1e3,this.neighbourDistance=400,this.parentElem=document.body,this.worldWidth=100,this.worldHeight=100,this.home=new s(this.worldWidth/2,this.worldHeight/2,0),this.starlings=[],this.homingMod=.024*this.homing,this.alignmentMod=18e-5*this.alignment,this.cohesionMod=6*this.cohesion,this.separationMod=5.994*this.separation,this.onUpdate=function(t){},Object.assign(this,t);for(var e=0;e<this.starlingCount;e++)this.addStarling();this.randomiseHome&&(this._changeHomeFunc=function(){i._changeHome(),setTimeout(i._changeHomeFunc,i.homeChangeInterval)},this._changeHomeFunc()),this.averageDistance=new s,this.averagePosition=new s,this.averageVelocity=new s,this.homingVelocity=new s}var a=function(s){function t(t,i,e){s.call(this,t,i,e),this.zMod=1e-4,this.velocity=new s(Math.random(),Math.random(),Math.random()),this.maxSpeed=6,this.skill=Math.random()/10,this.skillVariant=new s}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.update=function(){this.skillVariant.x=(Math.random()-.5)*this.skill,this.skillVariant.y=(Math.random()-.5)*this.skill,this.skillVariant.z=(Math.random()-.5)*this.skill,this.velocity.normalise(this.maxSpeed),this.velocity.add(this.skillVariant),this.x+=this.velocity.x,this.y+=this.velocity.y,this.z+=this.velocity.z,this.skillVariant.reset()},t}(s);return t.prototype.addStarling=function(){var t=Math.random()*this.worldWidth/4+this.worldWidth/4,i=Math.random()*this.worldHeight/4+this.worldHeight/4,e=new a(t,i,0);this.starlings.push(e)},t.prototype._changeHome=function(){this.home.x=this.worldWidth*Math.random(),this.home.y=this.worldHeight*Math.random(),this.home.z=.1},t.prototype.run=function(){var t=this;requestAnimationFrame(function(){return t.run()}),this.updateStarlings(),this.onUpdate(this.starlings)},t.prototype.alignStarling=function(t){for(var i=0,e=0;e<this.starlingCount;e++){var s=this.starlings[e];t!=s&&t.getDistanceFrom(s)<this.neighbourDistance&&(this.averageVelocity.x=s.velocity.x,this.averageVelocity.y=s.velocity.y,this.averageVelocity.z=s.velocity.z,i++)}this.averageVelocity.x/=i,this.averageVelocity.y/=i,this.averageVelocity.z/=i,this.averageVelocity.normalise(1),this.averageVelocity.multiply(this.alignmentMod),0<i&&t.velocity.add(this.averageVelocity),this.averageVelocity.reset()},t.prototype.cohereStarling=function(t){for(var i=0,e=0;e<this.starlingCount;e++){var s=this.starlings[e];t!=s&&(t.getDistanceFrom(s)<this.neighbourDistance&&(this.averageDistance.x=s.x-t.x,this.averageDistance.y=s.y-t.y,this.averageDistance.z=s.z-t.z,i++),this.averagePosition.x+=s.x,this.averagePosition.y+=s.y,this.averagePosition.z+=s.z)}this.averagePosition.x/=this.starlings.length-1,this.averagePosition.y/=this.starlings.length-1,this.averagePosition.z/=this.starlings.length-1,this.averageDistance.x/=i,this.averageDistance.y/=i,this.averageDistance.z/=i,this.averageDistance.normalise(1),this.averageDistance.multiply(this.cohesionMod),0<i&&t.velocity.add(this.averageDistance),this.averageDistance.reset(),this.averagePosition.reset()},t.prototype.separateStarling=function(t){for(var i=0,e=0;e<this.starlingCount;e++){var s=this.starlings[e];t!=s&&t.getDistanceFrom(s)<this.neighbourDistance&&(this.averageDistance.x=s.x-t.x,this.averageDistance.y=s.y-t.y,this.averageDistance.z=s.z-t.z,i++)}this.averageDistance.x/=i,this.averageDistance.y/=i,this.averageDistance.z/=i,this.averageDistance.normalise(1),this.averageDistance.multiply(this.separationMod),0<i&&(t.velocity.x+=-1*this.averageDistance.x,t.velocity.y+=-1*this.averageDistance.y,t.velocity.z+=-1*this.averageDistance.z),this.averageDistance.reset()},t.prototype.homeStarling=function(t){this.homingVelocity.x=this.home.x-t.x,this.homingVelocity.y=this.home.y-t.y,this.homingVelocity.z=this.home.z-t.z,this.homingVelocity.normalise(1),this.homingVelocity.multiply(this.homingMod*(10*Math.random())),t.velocity.add(this.homingVelocity),this.homingVelocity.reset()},t.prototype.updateStarlings=function(){for(var t=0;t<this.starlingCount;t++){var i=this.starlings[t];this.alignStarling(i),this.cohereStarling(i),this.separateStarling(i),this.homeStarling(i),i.update()}},t}();
